================================================================================
ä¿®æ”¹æ±‡æ€» - è®­ç»ƒé—®é¢˜ä¿®å¤ (2025-11-22)
================================================================================

ã€æ€»ä½“æ”¹åŠ¨ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é—®é¢˜æè¿°: Step 34è®­ç»ƒæ€§èƒ½æ€¥é€Ÿä¸‹é™ (45.8% â†’ 16.7%)
æ ¹æœ¬åŸå› : çº§è”æ•…éšœ (import bug + è·¯å¾„æ˜ å°„ç¼ºå¤± + å­—æ®µç¼ºå¤±)
ä¿®å¤æ–¹æ³•: 3ä¸ªç‹¬ç«‹ä¿®å¤ + 1æ¬¡æ•°æ®é‡ç”Ÿæˆ
ä¿®å¤çŠ¶æ€: âœ… å…¨éƒ¨å®Œæˆå¹¶éªŒè¯

ã€æ”¹åŠ¨ç»Ÿè®¡ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ–‡ä»¶ä¿®æ”¹:     2ä¸ª  (reward_computer.py, process_datasets.py)
æ–‡ä»¶æ–°å¢:     1ä¸ª  (setup_data_paths.py)
ç›®å½•åˆ›å»º:     1ä¸ª  (data/datasets/)
symlinkåˆ›å»º:  2ä¸ª  (humaneval, mbppæ˜ å°„)
æ•°æ®é‡ç”Ÿæˆ:   1æ¬¡  (train_mixed.jsonl)
ä»£ç è¡Œæ•°:     ~80  (æ–°å¢+ä¿®æ”¹)
éªŒè¯çŠ¶æ€:     âœ…  å…¨éƒ¨é€šè¿‡

================================================================================
ã€ä¿®æ”¹1ã€‘src/reward_computer.py - Import Bugä¿®å¤
================================================================================

æ–‡ä»¶ä½ç½®: src/reward_computer.py
ä¿®æ”¹è¡Œå·: 6, 11
ä¿®æ”¹ç±»å‹: Bugä¿®å¤

--- ä¿®æ”¹å‰
    1: #!/usr/bin/env python3
    2: """
    3: å¥–åŠ±è®¡ç®—å™¨ - æ”¹è¿›ç‰ˆ(å€Ÿé‰´ROLLå’ŒAgentFlowè®¾è®¡)
    4: """
    5: import sys
    6: import re  â† ç¼ºå°‘ import os
    7: from typing import Any, Dict, Optional
    8:
    9: # æ·»åŠ AFlowåˆ°è·¯å¾„
   10: sys.path.insert(0, 'os.getenv("AFLOW_PATH", "./AFlow")')  â† å­—ç¬¦ä¸²åŒ–bug
   11:

+++ ä¿®æ”¹å
    1: #!/usr/bin/env python3
    2: """
    3: å¥–åŠ±è®¡ç®—å™¨ - æ”¹è¿›ç‰ˆ(å€Ÿé‰´ROLLå’ŒAgentFlowè®¾è®¡)
    4: """
    5: import sys
    6: import os  â† æ–°å¢
    7: import re
    8: from typing import Any, Dict, Optional
    9:
   10: # æ·»åŠ AFlowåˆ°è·¯å¾„
   11: sys.path.insert(0, os.getenv("AFLOW_PATH", "./AFlow"))  â† ä¿®å¤
   12:

éªŒè¯å‘½ä»¤:
  $ grep "^import os" src/reward_computer.py
  ç»“æœ: import os âœ…

  $ grep "sys.path.insert(0, os.getenv" src/reward_computer.py
  ç»“æœ: sys.path.insert(0, os.getenv("AFLOW_PATH", "./AFlow")) âœ…

================================================================================
ã€ä¿®æ”¹2aã€‘scripts/process_datasets.py - HumanEval entry_pointä¿ç•™
================================================================================

æ–‡ä»¶ä½ç½®: scripts/process_datasets.py
ä¿®æ”¹è¡Œå·: 266 (åœ¨ç¬¬266è¡Œæ·»åŠ )
ä¿®æ”¹ç±»å‹: åŠŸèƒ½å¢å¼º

--- ä¿®æ”¹å‰ (ç¬¬259-270è¡Œ)
    259:                    sample = {
    260:                        "id": f"humaneval_{idx}",
    261:                        "dataset": "humaneval",
    262:                        "domain": "code",
    263:                        "question": item.get("prompt", ""),
    264:                        "reference_answer": item.get("canonical_solution", ""),
    265:                        "answer_type": "code",
    266:                        "metadata": {  â† ç›´æ¥è·Ÿmetadataï¼Œç¼ºå°‘entry_point
    267:                            "source": "humaneval",
    268:                            "original_id": str(item.get("task_id", idx))
    269:                        }
    270:                    }

+++ ä¿®æ”¹å (ç¬¬259-271è¡Œ)
    259:                    sample = {
    260:                        "id": f"humaneval_{idx}",
    261:                        "dataset": "humaneval",
    262:                        "domain": "code",
    263:                        "question": item.get("prompt", ""),
    264:                        "reference_answer": item.get("canonical_solution", ""),
    265:                        "answer_type": "code",
    266:                        "entry_point": item.get("entry_point", ""),  â† æ–°å¢
    267:                        "metadata": {
    268:                            "source": "humaneval",
    269:                            "original_id": str(item.get("task_id", idx))
    270:                        }
    271:                    }

éªŒè¯å‘½ä»¤:
  $ python scripts/process_datasets.py
  è¾“å‡º: âœ… HumanEval: 164 æ ·æœ¬ (train:136 test:28)

  $ head -1 data/processed/humaneval/test.jsonl | python3 -c "import json,sys; d=json.load(sys.stdin); print('entry_point:', d.get('entry_point'))"
  ç»“æœ: entry_point: is_sorted âœ…

================================================================================
ã€ä¿®æ”¹2bã€‘scripts/process_datasets.py - MBPPå‡½æ•°åæå–
================================================================================

æ–‡ä»¶ä½ç½®: scripts/process_datasets.py
ä¿®æ”¹è¡Œå·: 314-327 (æ–°å¢)
ä¿®æ”¹ç±»å‹: åŠŸèƒ½å¢å¼º

--- ä¿®æ”¹å‰ (ç¬¬312-323è¡Œ)
    312:                    sample = {
    313:                        "id": f"mbpp_{idx}",
    314:                        "dataset": "mbpp",
    315:                        "domain": "code",
    316:                        "question": item.get("text", ""),
    317:                        "reference_answer": item.get("code", ""),
    318:                        "answer_type": "code",
    319:                        "metadata": {  â† ç›´æ¥è·Ÿmetadataï¼Œç¼ºå°‘entry_point
    320:                            "source": "mbpp",
    321:                            "original_id": str(item.get("task_id", idx))
    322:                        }
    323:                    }

+++ ä¿®æ”¹å (ç¬¬312-332è¡Œ)
    312:                    # ä»codeä¸­æå–å‡½æ•°åä½œä¸ºentry_point  â† æ–°å¢
    313:                    code = item.get("code", "")  â† æ–°å¢
    314:                    import re as regex_module  â† æ–°å¢
    315:                    match = regex_module.search(r'def\s+(\w+)\s*\(', code)  â† æ–°å¢
    316:                    entry_point = match.group(1) if match else f"func_{idx}"  â† æ–°å¢
    317:
    318:                    sample = {  â† ä¹‹åçš„å†…å®¹è¡Œå·å‘ä¸‹ç§»åŠ¨
    319:                        "id": f"mbpp_{idx}",
    320:                        "dataset": "mbpp",
    321:                        "domain": "code",
    322:                        "question": item.get("text", ""),
    323:                        "reference_answer": item.get("code", ""),
    324:                        "answer_type": "code",
    325:                        "entry_point": entry_point,  â† æ–°å¢
    326:                        "metadata": {
    327:                            "source": "mbpp",
    328:                            "original_id": str(item.get("task_id", idx))
    329:                        }
    330:                    }

éªŒè¯å‘½ä»¤:
  $ python scripts/process_datasets.py
  è¾“å‡º: âœ… MBPP: 374 æ ·æœ¬ (train:311 test:63)

  $ head -1 data/processed/mbpp/test.jsonl | python3 -c "import json,sys; d=json.load(sys.stdin); print('entry_point:', d.get('entry_point'))"
  ç»“æœ: entry_point: max_chain_length âœ…

================================================================================
ã€ä¿®æ”¹3ã€‘scripts/setup_data_paths.py - æ–°å¢æ•°æ®æ˜ å°„è„šæœ¬
================================================================================

æ–‡ä»¶ä½ç½®: scripts/setup_data_paths.py (æ–°å¢)
ä¿®æ”¹ç±»å‹: æ–°å¢æ–‡ä»¶
è¡Œæ•°: ~250è¡Œ

ä¸»è¦åŠŸèƒ½:
  1. åˆ›å»º data/datasets/ ç›®å½•
  2. åˆ›å»ºsymlinkæ˜ å°„
     - data/datasets/humaneval_public_test.jsonl â†’ ../raw/code/humaneval.jsonl
     - data/datasets/mbpp_public_test.jsonl â†’ ../raw/code/mbpp.jsonl
  3. Windowså…¼å®¹æ€§å¤„ç†ï¼ˆsymlinkå¤±è´¥æ—¶è‡ªåŠ¨å¤åˆ¶ï¼‰
  4. å®Œæ•´çš„éªŒè¯å’Œæ—¥å¿—è¾“å‡º

æ‰§è¡Œæ–¹æ³•:
  python scripts/setup_data_paths.py

è¾“å‡ºç¤ºä¾‹:
  âœ… åˆ›å»ºç›®å½•: /root/llm-as-judge/data/datasets
  âœ… humaneval_public_test.jsonl â†’ ../raw/code/humaneval.jsonl
  âœ… mbpp_public_test.jsonl â†’ ../raw/code/mbpp.jsonl
  âœ… éªŒè¯: é€šè¿‡

éªŒè¯å‘½ä»¤:
  $ ls -l data/datasets/
  ç»“æœ: 2ä¸ªsymlinkï¼ŒæŒ‡å‘æ­£ç¡®ä½ç½® âœ…

================================================================================
ã€ä¿®æ”¹4ã€‘data/datasets/ - Symlinkåˆ›å»º
================================================================================

åˆ›å»ºæ–¹æ³•: é€šè¿‡ scripts/setup_data_paths.py

ç»“æ„:
  data/datasets/
  â”œâ”€â”€ humaneval_public_test.jsonl (symlink)
  â”‚   â””â”€â”€ æŒ‡å‘: ../raw/code/humaneval.jsonl (164 lines, 210KB)
  â””â”€â”€ mbpp_public_test.jsonl (symlink)
      â””â”€â”€ æŒ‡å‘: ../raw/code/mbpp.jsonl (374 lines, 209KB)

éªŒè¯:
  $ readlink data/datasets/humaneval_public_test.jsonl
  ç»“æœ: ../raw/code/humaneval.jsonl âœ…

  $ wc -l data/datasets/*.jsonl
  ç»“æœ: 164 + 374 = 538 æ€»è¡Œæ•° âœ…

================================================================================
ã€ä¿®æ”¹5ã€‘data/mixed/ - æ•°æ®é‡ç”Ÿæˆ
================================================================================

æ–‡ä»¶ä½ç½®: data/mixed/train_mixed.jsonl
ä¿®æ”¹ç±»å‹: æ•°æ®é‡ç”Ÿæˆ
æ‰§è¡Œå‘½ä»¤: python scripts/process_datasets.py

ä¿®æ”¹å‰:
  - codeæ ·æœ¬: 621ä¸ª
  - entry_point: âŒ å…¨éƒ¨ç¼ºå¤±

ä¿®æ”¹å:
  - codeæ ·æœ¬: 621ä¸ª
  - entry_point: âœ… å…¨éƒ¨å­˜åœ¨
  - æ ·æœ¬ç¤ºä¾‹:
    {
      "dataset": "humaneval",
      "domain": "code",
      "entry_point": "has_close_elements",  â† æ–°å¢
      ...
    }
    {
      "dataset": "mbpp",
      "domain": "code",
      "entry_point": "max_chain_length",  â† æå–è‡ªcode
      ...
    }

éªŒè¯:
  $ python3 << 'EOF'
  import json
  with open('data/mixed/train_mixed.jsonl') as f:
      code = [json.loads(line) for line in f if json.loads(line).get('domain') == 'code']
      ep = [s for s in code if s.get('entry_point')]
      print(f"{len(ep)}/{len(code)} samples have entry_point")
  EOF
  ç»“æœ: 621/621 samples have entry_point âœ…

================================================================================
ã€éªŒè¯æ¸…å•ã€‘
================================================================================

âœ… æ£€æŸ¥1: Import os
   å‘½ä»¤: grep "^import os" src/reward_computer.py
   ç»“æœ: âœ… import os

âœ… æ£€æŸ¥2: os.getenv è°ƒç”¨
   å‘½ä»¤: grep "sys.path.insert(0, os.getenv" src/reward_computer.py
   ç»“æœ: âœ… os.getenv("AFLOW_PATH", "./AFlow")

âœ… æ£€æŸ¥3: Symlink humaneval
   å‘½ä»¤: test -L data/datasets/humaneval_public_test.jsonl && echo "âœ…"
   ç»“æœ: âœ…

âœ… æ£€æŸ¥4: Symlink mbpp
   å‘½ä»¤: test -L data/datasets/mbpp_public_test.jsonl && echo "âœ…"
   ç»“æœ: âœ…

âœ… æ£€æŸ¥5: Entry_point in mixed data
   å‘½ä»¤: python3 << 'EOF' (è§ä¸Šæ–¹)
   ç»“æœ: âœ… 621/621

âœ… æ£€æŸ¥6: æ•°æ®æµå®Œæ•´æ€§
   å‘½ä»¤: python3 << 'EOF' (éªŒè¯æ•´ä¸ªæµç¨‹)
   ç»“æœ: âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡

================================================================================
ã€é¢„æœŸæ•ˆæœã€‘
================================================================================

ä¿®å¤å‰ (Step 34):
  - æ€»å‡†ç¡®ç‡: 16.7% (4/24) âŒ
  - Codeå‡†ç¡®ç‡: 12.5% âŒ
  - QAå‡†ç¡®ç‡: 0% âŒ
  - å¥–åŠ±ä¿¡å·: å…¨ä¸º0æˆ–è´Ÿæ•°
  - LLM Judge: åˆå§‹åŒ–å¤±è´¥

ä¿®å¤å (é¢„æœŸ):
  - æ€»å‡†ç¡®ç‡: >45% âœ…
  - Codeå‡†ç¡®ç‡: >20% âœ…
  - QAå‡†ç¡®ç‡: >50% âœ…
  - å¥–åŠ±ä¿¡å·: æœ‰æ•ˆèŒƒå›´ [-1, 1]
  - LLM Judge: æ­£å¸¸å·¥ä½œ

æ€§èƒ½æ¢å¤: +28.3pp

================================================================================
ã€æ³¨æ„äº‹é¡¹ã€‘
================================================================================

âš ï¸  é‡è¦:
  1. æ‰€æœ‰ä¿®æ”¹å·²éªŒè¯é€šè¿‡
  2. æ— éœ€ä¿®æ”¹AFlowæºä»£ç 
  3. ä¿®æ”¹å‘åå…¼å®¹
  4. æ•°æ®å¤„ç†æµç¨‹å®Œæ•´

âœ… å»ºè®®:
  1. æ¸…ç†æ—§æ—¥å¿—å’Œcheckpoints
  2. é‡å¯è®­ç»ƒ
  3. ç›‘æ§å‰10æ­¥çš„æ€§èƒ½æŒ‡æ ‡
  4. è®°å½•æ–°çš„è®­ç»ƒæˆæœ

ğŸ“š å‚è€ƒæ–‡æ¡£:
  - docs/TRAINING_ISSUE_REPORT_20251122.md (è¯¦ç»†è¯Šæ–­æŠ¥å‘Š)
  - QUICK_REFERENCE.txt (å¿«é€Ÿå‚è€ƒ)
  - CHANGES_LOG.md (ä¿®æ”¹å˜æ›´æ—¥å¿—)

================================================================================
ç”Ÿæˆæ—¥æœŸ: 2025-11-22
ç»´æŠ¤è€…: Claude Code / ultrathink
ç‰ˆæœ¬: 1.0
================================================================================
